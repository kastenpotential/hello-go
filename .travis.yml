language: go

go:
    - 1.12.x

sudo: required

services:
    - docker

before_script:
    - docker pull amarantin/hello-go:latest || true

script:
    - docker build --pull --cache-from amarantin/hello-go:latest --tag amarantin/hello-go .
    - docker run amarantin/hello-go

after_script:
    - docker images

before_deploy:
    - docker login -u "$REGISTRY_USER" -p "$REGISTRY_PASS"

deploy:
    provider: script
    script: docker push amarantin/hello-go
    on:
        branch: master

jobs:
    include:
        # Define the release stage that runs semantic-release
        - stage: release
            # Advanced: optionally overwrite your default `script` step to skip the tests
            # script:
            #   - make
            deploy:
                provider: script
                skip_cleanup: true
                script:
                    # Use nvm to install and use the Node LTS version (nvm is installed on all Travis images)
                    - nvm install lts/*
                    - npx semantic-release


